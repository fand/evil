(function(){this.SidebarView=function(){function t(t){this.model=t,this.wrapper=$("#sidebar-wrapper"),this.tracks=this.wrapper.find("#sidebar-tracks"),this.master=this.wrapper.find("#sidebar-master"),this.master_display=this.master.find(".display"),this.master_control=this.master.find(".control"),this.master_display_label=this.master.find(".display-current-control"),this.master_edit=this.master.find("[name=edit]"),this.master_name=this.master.find("[name=name]"),this.master_bpm=this.master.find("[name=bpm]"),this.master_key=this.master.find("[name=key]"),this.master_scale=this.master.find("[name=mode]"),this.master_save=this.master.find("[name=save]"),this.master_effects=this.master.find(".sidebar-effects"),this.add_master=this.master.find(".add-type"),this.add_master_btn=this.master.find(".add-btn"),this.tracks_effects=this.tracks.find(".sidebar-effects"),this.add_tracks=this.tracks.find(".add-type"),this.add_tracks_btn=this.tracks.find(".add-btn"),this.initEvent()}return t.prototype.initEvent=function(){var t,e,s,r;for(this.master_name.on("focus",function(){return function(){return window.keyboard.beginInput()}}(this)).on("blur",function(){return function(){return window.keyboard.endInput()}}(this)).on("change",function(t){return function(){return t.saveMaster()}}(this)),r=[this.master_bpm,this.master_key,this.master_scale],e=0,s=r.length;s>e;e++)t=r[e],t.on("focus",function(){return function(){return window.keyboard.beginInput()}}(this)).on("blur",function(){return function(){return window.keyboard.endInput()}}(this));return this.master_save.on("click",function(t){return function(){return t.saveMaster(),t.hideMasterControl()}}(this)),this.master_edit.on("click",function(t){return function(){return t.showMasterControl()}}(this)),this.tracks.find(".sidebar-effect").each(function(t){return function(e){return $(t).on("change",function(){return t.model.readTracksEffect(e)})}}(this)),this.add_master_btn.on("click",function(t){return function(){return t.addMasterEffect(t.add_master.val())}}(this)),this.add_tracks_btn.on("click",function(t){return function(){return t.addTracksEffect(t.add_tracks.val())}}(this))},t.prototype.saveMaster=function(){var t,e,s,r,n;return s=this.master_name.val(),t=this.master_bpm.val(),e=this.master_key.val(),n=this.master_scale.val(),r={name:null!=s?s:void 0,bpm:null!=t?t:void 0,key:null!=e?e:void 0,scale:null!=n?n:void 0},this.model.saveMaster(r),this.showMaster(r)},t.prototype.clearMaster=function(){var t;return t={name:this.master_name.val()},this.model.saveMaster(t),this.showMaster(t)},t.prototype.saveTracksEffect=function(){var t,e,s,r,n;for(r=this.tracks_effects,n=[],e=0,s=r.length;s>e;e++)t=r[e],n.push(t.getParam());return n},t.prototype.showTracks=function(t){var e,s,r,n;for(this.tracks_effects.find(".sidebar-effect").remove(),n=t.effects,s=0,r=n.length;r>s;s++)e=n[s],e.appendTo(this.tracks_effects);return this.wrapper.css("left","0px")},t.prototype.showMaster=function(t){var e;return this.hideMasterControl(),e="",null!=t.name&&this.master_name.val(t.name),null!=t.bpm&&(e+=t.bpm+" BPM 　"),null!=t.key&&(e+=t.key+" 　"),null!=t.scale&&(e+=t.scale),this.master_display_label.text(e),this.wrapper.css("left","-223px")},t.prototype.showMasterControl=function(){return this.master_control.show(),this.master_display.hide()},t.prototype.hideMasterControl=function(){return this.master_display.show(),this.master_control.hide()},t.prototype.addMasterEffect=function(t){var e;return e=this.model.addMasterEffect(t),e.appendTo(this.master_effects)},t.prototype.addTracksEffect=function(t){var e;return e=this.model.addTracksEffect(t),e.appendTo(this.tracks_effects)},t.prototype.setBPM=function(t){return this.master_bpm.val(t)},t.prototype.setKey=function(t){return this.master_key.val(t)},t.prototype.setScale=function(t){return this.master_scale.val(t)},t}()}).call(this);